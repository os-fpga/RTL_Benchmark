#!/bin/sh
orig=$(pwd)

if [ ! -d ./log ]; then
	mkdir log
fi

if [ ! -d ./netlist ]; then
	mkdir netlist
fi

if [ ! -d ./ddc ]; then
	mkdir ddc
fi

if [ ! -d ./rpt ]; then
	mkdir rpt
fi

if [ ! -d ./work ]; then
	mkdir work
fi

rm -f log/*
rm -f rpt/*
rm -rf alib-52

# check synthesis period
core_clk_period=`cat core_env.tcl | grep core_clk_period | sed 's/set\s\+core_clk_period\s\+//g'`
echo "INFO: Running Dhrystone for power pattern with core_clk period $core_clk_period"
cd $NDS_HOME/andes_vip/patterns/samples/test_dhrystone_v5
make clean
make VPLUSDEFINES="+define+AE350_OSCH_PERIOD=$core_clk_period" NOCOSIM=1 ;make getdmips;make gensaif VPLUSDEFINES="+define+AE350_OSCH_PERIOD=$core_clk_period" NOCOSIM=1
echo "INFO: Power pattern is generated"
cp verilog.saif pf_info.tcl $orig
cd $orig

cp ../top/hdl/config.inc ./
echo "INFO: Copy config.inc to here"
dc_shell-t -f ./script/kv_core.tcl < /dev/null | tee ./log/run_syn.log

rm -rf synopsys*
rm -rf dw*
rm -f work/*
