#!/bin/sh

if [ -f "./log/dc.log.gz" ]; then
	gzip -d log/dc.log.gz
fi

if [ -f "rpt/check_design.rpt.gz" ]; then
	gzip -d rpt/check_design.rpt.gz
fi

# Ignored Warnings:
#       (CMD-018)  Warning: duplicate option %s overrides previous value.
#	(UCN-1)    Warning: In the design *s, net 'n_Logic1|_Logic0' is connecting multiple ports.
#                           Only allow this warning on kv_cpuid
#       (UCN-4)    Warning: The specified replacement character (%c) is conflicting with the specified allowed or restricted character.
#       (ELAB-304) Warning: Case or if statement, or ?: operator has an infer_mux attribute and a default branch or incomplete mapping. This might cause nonoptimal logic if a MUX is inferred.
# 	(ELAB-311) Warning: DEFAULT branch of CASE statement cannot be reached.
# 	(ELAB-335) Warning: 'Case' statement is full and has only one nontrivial branch; it will be inlined. 
# 	(ELAB-338) Warning: %s Module %s contains a supply%d variable %s. Replacing with wire driven by a continuous assignment to %d
#	(ELAB-391) Warning: Variable %s may be read before being assigned; the synthesized result may not match simulations.
#	(ELAB-985) Warning: Netlist for always block is empty.
# 	(VER-61)   Warning: %s Statement unreachable %s.
# 	           - this should be verified by coverage test
# 	           - some is unreachable because the input of generated code block has constant input (reviewed)
#	(VER-130)  Warning: %s: Intraassignment delays for nonblocking assignments are ignored. 
#	(VER-173)  Warning: %s: delays for continuous assignment are ignored. 
#	(VER-282)  Warning: All isolation_upf and retention_upf pragmas are ignored.
#	(VER-314)  Warning: %s Starting with the 2000.11-1 release, the Presto Verilog reader treats Verilog integer types as signed; synthesized result may not match earlier versions of HDL Compiler.
#	(VER-318)  Warning: %s %s to %s %s occurs. 
#	(VER-921)  Warning: %s The macro %s you are attempting to undefine with the `undef directive is not defined.
#	(VO-2)    Warning: Changed wire name %s to %s in module. Please use the change_names command to make the correct changes before invoking the verilog writer.
#	(VO-4)     Warning: Verilog assign or tran statements are written out.
#	(VO-11)    Warning: Verilog writer has added %d nets to module %s using %s as prefix. Please use the change_names command to make the correct changes before invoking the verilog writer.
#       (LINT-63)  Warning: Net %s has a single tri-state driver.
#       (TIM-134)  Warning: Design %s contains %d high-fanout nets. A fanout number of %d will be used for delay calculations involving these nets.
#       (TIM-164)  Warning: The trip points for the library named %s differ from those in the library named %s.
#       (UID-101)  Warning: Attribute %s does not exist on %s %s.
#       (UID-60)   Warning: Ignoring compile_fix_multiple_port_nets = %s.
#                  Warning: Filename too long >255 chars. Renaming file: %s.
#	(UID-348)  Warning: Creating virtual clock named '%s' with no sources.
#	(UID-494)  Warning: No -early or -late option is specified.
#	(UISN-40)  Warning: DesignWare synthetic library dw_foundation.sldb is added to the synthetic_library in the current command.
#	(OPT-1342) Warning: The -timing_high_effort_script option is ignored.
#	(OPT-109)  Warning: In %s, there are sequential cells not driving any load.
#	(PWR-12)   Warning: The derived toggle rate value (%f) for the clock net '%s' conflicts with the annotated value (%f). Using the annotated value.
#	(PWR-19)   Warning: There are %d switching activity information conflicts.
#	(PWR-415)  Warning: Design has unannotated sequential cell outputs.
#	(PWR-421)  Warning: Invalid switching activity annotation on constant net(s) is being ignored.
#	(PWR-428)  Warning: Design has unannotated black box outputs.
#	(UPF-213a) Warning: The net driven by the pin %s is not eligible for isolation insertion with source/sink as it is not loaded.
#	(MV-039)   Warning: Found XX isolation cells or enable level shifters with inputs connected to logic constants that differ from disable state of these cells.
#	(DDB-74)   Warning: Design '%s' inherited license information from design '%s'.
#

FIND_FILE0="log/*.log"
FIND_MESSAGE0="Error|resolve |assign |Warning"
WAIVER0="\
CMD-018\)|UCN-4\)|kv_cpuid.+UCN-1\)|\
ELAB-304\)|ELAB-311\)|ELAB-335\)|ELAB-338\)|ELAB-391\)|ELAB-985\)|\
VER-61\)|VER-130\)|VER-173\)|VER-282\)|VER-314\)|VER-318\)|VER-921\)|\
VO-2\)|VO-4\)|VO-11\)|\
OPT-109\)|\
LINT-63\)|\
TIM-134\)|TIM-164\)|\
UID-101\)|UID-60\)|UID-348\)|UID-494\)|\
UISN-40\)|\
OPT-1342\)|\
PWR-12\)|PWR-19\)|PWR-415\)|PWR-421\)|PWR-428\)|\
UPF-213a\)|MV-039\)|\
DDB-74\)|\
Filename too long >255 chars|^log/dc\.log:Error: 0\$"
TOTAL0=`cat ${FIND_FILE0} | egrep -c "${FIND_MESSAGE0}"`
WAIVED0=`cat ${FIND_FILE0} | egrep "${FIND_MESSAGE0}" | egrep -c "${WAIVER0}"`

# (LINT-4) Information: In design %s, net %s has multiple drivers. Wired AND assumed.
FIND_FILE1="rpt/check_design.rpt"
FIND_MESSAGE1="Error|LINT-4\)"
TOTAL1=`cat ${FIND_FILE1} | egrep -c "${FIND_MESSAGE1}"`
WAIVED1=0

# (OPT-150)  Information: Timing loop detected. 
FIND_FILE2="log/compile.log"
FIND_MESSAGE2="OPT-150\)"
TOTAL2=`cat ${FIND_FILE2} | egrep -c "${FIND_MESSAGE2}"`
WAIVED2=0

TOTAL=`expr $TOTAL0 + $TOTAL1 + $TOTAL2` 
WAIVED=`expr $WAIVED0 + $WAIVED1 + $WAIVED2` 

echo "Number of warning and error messages: ${TOTAL}"
echo "Number of waived messages: ${WAIVED}"
NONE_WAIVED=`expr $TOTAL - $WAIVED`
if [[ ${NONE_WAIVED} != 0 ]] ; then
	echo "Non-waived messages:"
	cat ${FIND_FILE0} | egrep "${FIND_MESSAGE0}" | egrep -v "${WAIVER0}"
	cat ${FIND_FILE1} | egrep "${FIND_MESSAGE1}"
	cat ${FIND_FILE2} | egrep "${FIND_MESSAGE2}"
else
	if [[ ${TOTAL} != 0 ]] ; then
		echo "All warning and error messages are reviewed by Andes and can be waived."
	fi
fi

echo ""
echo "Please see the ${0##*/} for more details on parser and waiver."

