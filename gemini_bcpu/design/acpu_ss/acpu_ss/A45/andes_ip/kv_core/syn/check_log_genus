#!/bin/sh

if [ -f "./log/genus.log.gz" ]; then
	gzip -d log/genus.log.gz
fi

# Ignored Warnings:
#	(LBR-9)	    Library cell has no output pins defined.
#       (LBR-38)    Libraries have inconsistent nominal operating conditions
#       (LBR-96)    Duplicate when conditions found.
#       (LBR-101)   Unusable clock gating integrated cell.
#       (LBR-106)   Invalid object for attribute when using library domains.
#       (LBR-403)   Warning : Ignoring unsupported lu_table_template.
#       (TIM-11)    Possible timing problems have been detected in this design.
#       (TUI-32)    This attribute will be obsolete in a next major release.
#       (TUI-37)    This command will be obsolete in a next major release.
#       (TUI-67)    The attribute is not applicable to the object.
#       (TUI-92)    Cannot set probability or toggle rate on a constant net.
#       (TUI-224)   Specified shift values are equivalent to the default timing relationship.
#       (TUI-295)   Cannot dedicate fully preserved or ILM module.
#       (VLOGPT-6)  Replacing previously read Verilog description.
#       (VLOGPT-35) Ignoring delay specifier.
#       (CDFG-236)  Detected non-positive value for replication prefix.
#       (CDFG-472)  Unreachable statements for case item.
#       (CDFG-508)  Removing unused register. 
#       (CDFG-818)  Using default parameter value for module elaboration.
#       (MAP-136)   The Parallel Incremental Optimization failed.
#	(MESG-6)    Message truncated because it exceeds the maximum length of 4096 characters.
#	(RPT-13)    Clock period mismatch between synthesis(SDC) and simulation(VCD/TCF/SAIF) values.
#	(ST-136)    Not obtained requested number of super thread servers.
#	(PBS-2)	    Genus synthesis should be run with a minimum of 8 threads.
#	(POPT-33)   Failed to connect test signal to clock-gating logic.
#	(POPT-505)  Attribute 'power_library' is not set. (TODO)
#	(CG-428)    Could not remove the specified generic clock gating instance.
#	(CG-422)    Cannot remove clock-gating instance, which is driving flops that do not have a unique data pin.
#	(CG-602)    Failed to uniquify the design.
#	(PI-402)    Could not find an object.
#       (CPI-342)   Missing active state for power domain.
#       (CPI-353)   Skipping insertion on floating pin.
#       (CPI-365)   Inverter not found.

# Unwanted message:
#       > puts "Error ..."
#

FIND_FILE0="log/*.log"
FIND_MESSAGE0="blackbox|Error|combinational loop|Unconnect|Undriven|Cannot resolve|Warning|Abnormal exit"
WAIVER0="\
LBR-9\]|LBR-38\]|LBR-96\]|LBR-101\]|LBR-106\]|LBR-403\]|LBR-420\]|\
TIM-11\]|\
TUI-32\]|TUI-37\]|TUI-67\]|TUI-92\]|TUI-224\]|TUI-295\]|\
VLOGPT-6\]|VLOGPT-35\]|\
CDFG-236\]|CDFG-472\]|CDFG-508\]|CDFG-818\]|\
MAP-136\]|\
MESG-6\]|\
RPT-13\]|\
ST-136\]|\
PBS-2\]|\
POPT-33\]|POPT-505\]|\
CG-428\]|CG-422\]|CG-602\]|\
PI-402\]|\
CPI-342\]|CPI-353\]|CPI-365\]|\
puts\s\"Error|Error=0, Fatal=0"
TOTAL=`cat ${FIND_FILE0} | egrep -c "${FIND_MESSAGE0}"`
WAIVED=`cat ${FIND_FILE0} | egrep "${FIND_MESSAGE0}" | egrep -c "${WAIVER0}"`

echo "Number of warning and error messages: ${TOTAL}"
echo "Number of waived messages: ${WAIVED}"
NONE_WAIVED=`expr $TOTAL - $WAIVED`
if [[ ${NONE_WAIVED} != 0 ]] ; then
	echo "Non-waived messages:"
	cat ${FIND_FILE0} | egrep "${FIND_MESSAGE0}" | egrep -v "${WAIVER0}"
else
	if [[ ${TOTAL} != 0 ]] ; then
		echo "All warning and error messages are reviewed by Andes and can be waived."
	fi
fi

echo ""
echo "Please see the ${0##*/} for more details on parser and waiver."
