#!/bin/sh
orig=$(pwd)

if [ ! -d ./log ]; then
	mkdir log
fi

rm -f log/*
rm -f genus.cmd

# check synthesis period
core_clk_period=`cat core_env.tcl | grep core_clk_period | sed 's/set\s\+core_clk_period\s\+//g'`
echo "INFO: Running Dhrystone for power pattern with core_clk period $core_clk_period"
cd $NDS_HOME/andes_vip/patterns/samples/test_dhrystone_v5
make clean
make VPLUSDEFINES="+define+AE350_OSCH_PERIOD=$core_clk_period" NOCOSIM=1;make getdmips;make gentcf VPLUSDEFINES="+define+AE350_OSCH_PERIOD=$core_clk_period" NOCOSIM=1
echo "INFO: Power pattern is generated"
cp verilog.tcf pf_info.tcl $orig
cd $orig

cp ../top/hdl/config.inc ./
echo "INFO: Copy config.inc to here"
genus -f ./script_rc/kv_core.tcl -log ./log/genus.log $NDS_GENUS_ARG
